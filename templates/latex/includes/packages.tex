% 基础包
\usepackage[utf8]{inputenc}
\usepackage{fontspec}
\usepackage[SlantFont,BoldFont]{xeCJK}
\usepackage{graphicx}   % 图片支持
\usepackage{geometry}   % 页面布局
\usepackage{titlesec}   % 标题控制
\usepackage{longtable}  % 长表格支持
\usepackage{booktabs}   % 表格美化
\usepackage{xcolor}     % 颜色支持
\usepackage{fancyvrb}   % 代码高亮支持
\usepackage{fvextra}    % 扩展的代码支持
\usepackage{upquote}    % 智能引号
\usepackage{microtype}  % 微排版
\usepackage{etoolbox}   % 工具包
\usepackage{unicode-math}    % Unicode数学支持
\usepackage{enumitem}       % 列表环境增强
\usepackage{caption}        % 图表标题
\usepackage{subcaption}     % 子图表支持
\usepackage{listings}       % 代码列表
\usepackage{makeidx}        % 索引支持
\usepackage{hyperref}       % 超链接支持
\usepackage{bookmark}       % PDF书签增强

% 定义代码高亮颜色
\definecolor{shadecolor}{RGB}{248,248,248}
\definecolor{commentcolor}{RGB}{128,128,128}
\definecolor{keywordcolor}{RGB}{0,112,192}
\definecolor{stringcolor}{RGB}{0,136,0}
\definecolor{identifiercolor}{RGB}{0,0,0}
\definecolor{numbercolor}{RGB}{128,0,128}

% 设置代码块
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{
    commandchars=\\\{\},
    breaklines=true,
    breakanywhere=true,
    fontsize=\small,
    frame=single,
    rulecolor=\color{black!30},
    framesep=3pt,
    baselinestretch=1.2,
    xleftmargin=0.5em,
    xrightmargin=0.5em,
    fontfamily=tt,
    formatcom=\setmonofont{Menlo}
}

% 定义代码块背景
\definecolor{shadecolor}{rgb}{.97, .97, .97}
\newenvironment{Shaded}{}{}

% 定义所有必要的代码高亮 token
\newcommand{\KeywordTok}[1]{\textcolor{keywordcolor}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\DecValTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\FloatTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\CharTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\StringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\CommentTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\OtherTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\AlertTok}[1]{\textcolor{red}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\ErrorTok}[1]{\textbf{\textcolor{red}{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\VariableTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\ControlFlowTok}[1]{\textbf{#1}}
\newcommand{\ConstantTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\ImportTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\InformationTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\WarningTok}[1]{\textcolor{red}{#1}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\SectionTok}[1]{\textbf{#1}}

% 页面设置
\geometry{
    a4paper,
    top=2.5cm,
    bottom=2.5cm,
    left=2.5cm,
    right=2.5cm,
    headheight=14pt,
    footskip=1cm,
    includehead,
    includefoot
}

% 中文字体设置
\setCJKmainfont[
    BoldFont={Songti SC},
    ItalicFont={Songti SC},
    BoldItalicFont={Songti SC}
]{Songti SC}
\setCJKsansfont[
    BoldFont={PingFang SC},
    ItalicFont={PingFang SC}
]{PingFang SC}

% 中文标点优化
\punctstyle{quanjiao}
\normalspacedchars{/}

% 基本命令
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% 代码高亮优化
\lstset{
    basicstyle=\small\ttfamily\setmonofont{Menlo},
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny,
    keywordstyle=\color{keywordcolor}\bfseries,
    commentstyle=\color{commentcolor}\CJKfamily{rm}\itshape,
    stringstyle=\color{stringcolor},
    % 设置中文字体
    texcl=true,
    keepspaces=true,
    columns=flexible,
    literate={
        {。}{{\CJKfamily{rm}。}}1
        {，}{{\CJKfamily{rm}，}}1
        {：}{{\CJKfamily{rm}：}}1
        {；}{{\CJKfamily{rm}；}}1
        {！}{{\CJKfamily{rm}！}}1
        {？}{{\CJKfamily{rm}？}}1
        {（}{{\CJKfamily{rm}（}}1
        {）}{{\CJKfamily{rm}）}}1
        {、}{{\CJKfamily{rm}、}}1
    }
}

% 优化段落间距
\setlength{\parskip}{0.5em}
\setlength{\parindent}{2em}

% hyperref 包需要放在最后
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    bookmarksnumbered=false,
    bookmarksopen=true,
    pdfstartview=FitH
}